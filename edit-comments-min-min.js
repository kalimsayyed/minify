var theList,theExtraList,toggleWithKeyboard=false;(function(i){var f,g,h,j;setCommentsList=function(){var q,o,d,a=0,e,c,p,b,r;q=i('input[name="_total"]',"#comments-form");o=i('input[name="_per_page"]',"#comments-form");d=i('input[name="_page"]',"#comments-form");e=function(n,x){var k=i("#"+x.element),y,l,w;y=i("#replyrow");l=i("#comment_ID",y).val();w=i("#replybtn",y);if(k.is(".unapproved")){if(x.data.id==l){w.text(adminCommentsL10n.replyApprove)}k.find("div.comment_status").html("0")}else{if(x.data.id==l){w.text(adminCommentsL10n.reply)}k.find("div.comment_status").html("1")}var m=i("#"+x.element).is("."+x.dimClass)?1:-1;h(m)};c=function(k,A){var y=i(k.target).attr("class"),n,m,l,B,z,C,D=false;k.data._total=q.val()||0;k.data._per_page=o.val()||0;k.data._page=d.val()||0;k.data._url=document.location.href;k.data.comment_status=i('input[name="comment_status"]',"#comments-form").val();if(y.indexOf(":trash=1")!=-1){D="trash"}else{if(y.indexOf(":spam=1")!=-1){D="spam"}}if(D){n=y.replace(/.*?comment-([0-9]+).*/,"$1");m=i("#comment-"+n);note=i("#"+D+"-undo-holder").html();m.find(".check-column :checkbox").prop("checked",false);if(m.siblings("#replyrow").length&&commentReply.cid==n){commentReply.close()}if(m.is("tr")){l=m.children(":visible").length;C=i(".author strong",m).text();B=i('<tr id="undo-'+n+'" class="undo un'+D+'" style="display:none;"><td colspan="'+l+'">'+note+"</td></tr>")}else{C=i(".comment-author",m).text();B=i('<div id="undo-'+n+'" style="display:none;" class="undo un'+D+'">'+note+"</div>")}m.before(B);i("strong","#undo-"+n).text(C);z=i(".undo a","#undo-"+n);z.attr("href","comment.php?action=un"+D+"comment&c="+n+"&_wpnonce="+k.data._ajax_nonce);z.attr("class","delete:the-comment-list:comment-"+n+"::un"+D+"=1 vim-z vim-destructive");i(".avatar",m).clone().prependTo("#undo-"+n+" ."+D+"-undo-inside");z.click(function(){A.wpList.del(this);i("#undo-"+n).css({backgroundColor:"#ceb"}).fadeOut(350,function(){i(this).remove();i("#comment-"+n).css("backgroundColor","").fadeIn(300,function(){i(this).show()})});return false})}return k};p=function(m,l,k){if(l<a){return}if(k){a=l}q.val(m.toString())};j=function(k){var l=i("#dashboard_right_now"),u,m,n,v;k=k||0;if(isNaN(k)||!l.length){return}u=i("span.total-count",l);m=i("span.approved-count",l);n=f(u);n=n+k;v=n-f(i("span.pending-count",l))-f(i("span.spam-count",l));g(u,n);g(m,v)};f=function(l){var k=parseInt(l.html().replace(/[^0-9]+/g,""),10);if(isNaN(k)){return 0}return k};g=function(l,k){var m="";if(isNaN(k)){return}k=k<1?"0":k.toString();if(k.length>3){while(k.length>3){m=thousandsSeparator+k.substr(k.length-3)+m;k=k.substr(0,k.length-3)}k=k+m}l.html(k)};h=function(k){i("span.pending-count").each(function(){var m=i(this),l=f(m)+k;if(l<1){l=0}m.closest(".awaiting-mod")[0==l?"addClass":"removeClass"]("count-0");g(m,l)});j()};b=function(m,G){var D,F,B,C,l,A=i(G.target).parent().is("span.untrash"),k=i(G.target).parent().is("span.unspam"),E=i("#"+G.element).is(".unapproved");function n(s){if(i(G.target).parent().is("span."+s)){return 1}else{if(i("#"+G.element).is("."+s)){return -1}}return 0}if(A){C=-1}else{C=n("trash")}if(k){B=-1}else{B=n("spam")}if(i(G.target).parent().is("span.unapprove")||((A||k)&&E)){l=1}else{if(E){l=-1}}if(l){h(l)}i("span.spam-count").each(function(){var t=i(this),s=f(t)+B;g(t,s)});i("span.trash-count").each(function(){var t=i(this),s=f(t)+C;g(t,s)});if(i("#dashboard_right_now").length){F=C?-1*C:0;j(F)}else{D=q.val()?parseInt(q.val(),10):0;if(i(G.target).parent().is("span.undo")){D++}else{D--}if(D<0){D=0}if(("object"==typeof m)&&a<G.parsed.responses[0].supplemental.time){total_items_i18n=G.parsed.responses[0].supplemental.total_items_i18n||"";if(total_items_i18n){i(".displaying-num").text(total_items_i18n);i(".total-pages").text(G.parsed.responses[0].supplemental.total_pages_i18n);i(".tablenav-pages").find(".next-page, .last-page").toggleClass("disabled",G.parsed.responses[0].supplemental.total_pages==i(".current-page").val())}p(D,G.parsed.responses[0].supplemental.time,true)}else{p(D,m,false)}}if(!theExtraList||theExtraList.size()==0||theExtraList.children().size()==0||A||k){return}theList.get(0).wpList.add(theExtraList.children(":eq(0)").remove().clone());r()};r=function(k){var m=i.query.get(),n=i(".total-pages").text(),l=i('input[name="_per_page"]',"#comments-form").val();if(!m.paged){m.paged=1}if(m.paged>n){return}if(k){theExtraList.empty();m.number=Math.min(8,l)}else{m.number=1;m.offset=Math.min(8,l)-1}m.no_placeholder=true;m.paged++;if(true===m.comment_type){m.comment_type=""}m=i.extend(m,{action:"fetch-list",list_args:list_args,_ajax_fetch_list_nonce:i("#_ajax_fetch_list_nonce").val()});i.ajax({url:ajaxurl,global:false,dataType:"json",data:m,success:function(t){theExtraList.get(0).wpList.add(t.rows)}})};theExtraList=i("#the-extra-comment-list").wpList({alt:"",delColor:"none",addColor:"none"});theList=i("#the-comment-list").wpList({alt:"",delBefore:c,dimAfter:e,delAfter:b,addColor:"none"}).bind("wpListDelEnd",function(l,m){var k=m.element.replace(/[^0-9]+/g,"");if(m.target.className.indexOf(":trash=1")!=-1||m.target.className.indexOf(":spam=1")!=-1){i("#undo-"+k).fadeIn(300,function(){i(this).show()})}})};commentReply={cid:"",act:"",init:function(){var a=i("#replyrow");i("a.cancel",a).click(function(){return commentReply.revert()});i("a.save",a).click(function(){return commentReply.send()});i("input#author, input#author-email, input#author-url",a).keypress(function(b){if(b.which==13){commentReply.send();b.preventDefault();return false}});i("#the-comment-list .column-comment > p").dblclick(function(){commentReply.toggle(i(this).parent())});i("#doaction, #doaction2, #post-query-submit").click(function(b){if(i("#the-comment-list #replyrow").length>0){commentReply.close()}});this.comments_listing=i('#comments-form > input[name="comment_status"]').val()||""},addEvents:function(a){a.each(function(){i(this).find(".column-comment > p").dblclick(function(){commentReply.toggle(i(this).parent())})})},toggle:function(a){if(i(a).css("display")!="none"){i(a).find("a.vim-q").click()}},revert:function(){if(i("#the-comment-list #replyrow").length<1){return false}i("#replyrow").fadeOut("fast",function(){commentReply.close()});return false},close:function(){var a,b=i("#replyrow");if(b.parent().is("#com-reply")){return}if(this.cid&&this.act=="edit-comment"){a=i("#comment-"+this.cid);a.fadeIn(300,function(){a.show()}).css("backgroundColor","")}if(typeof QTags!="undefined"){QTags.closeAllTags("replycontent")}i("#add-new-comment").css("display","");b.hide();i("#com-reply").append(b);i("#replycontent").css("height","").val("");i("#edithead input").val("");i(".error",b).html("").hide();i(".waiting",b).hide();this.cid=""},open:function(u,s,q){var a=this,t,r,d,c=i("#comment-"+u),e=c.height(),b;a.close();a.cid=u;t=i("#replyrow");r=i("#inline-"+u);q=q||"replyto";d="edit"==q?"edit":"replyto";d=a.act=d+"-comment";i("#action",t).val(d);i("#comment_post_ID",t).val(s);i("#comment_ID",t).val(u);if(e>120){i("#replycontent",t).css("height",(35+e)+"px")}if(q=="edit"){i("#author",t).val(i("div.author",r).text());i("#author-email",t).val(i("div.author-email",r).text());i("#author-url",t).val(i("div.author-url",r).text());i("#status",t).val(i("div.comment_status",r).text());i("#replycontent",t).val(i("textarea.comment",r).val());i("#edithead, #savebtn",t).show();i("#replyhead, #replybtn, #addhead, #addbtn",t).hide();c.after(t).fadeOut("fast",function(){i("#replyrow").fadeIn(300,function(){i(this).show()})})}else{if(q=="add"){i("#addhead, #addbtn",t).show();i("#replyhead, #replybtn, #edithead, #editbtn",t).hide();i("#the-comment-list").prepend(t);i("#replyrow").fadeIn(300)}else{b=i("#replybtn",t);i("#edithead, #savebtn, #addhead, #addbtn",t).hide();i("#replyhead, #replybtn",t).show();c.after(t);if(c.hasClass("unapproved")){b.text(adminCommentsL10n.replyApprove)}else{b.text(adminCommentsL10n.reply)}i("#replyrow").fadeIn(300,function(){i(this).show()})}}setTimeout(function(){var m,o,k,l,n;m=i("#replyrow").offset().top;o=m+i("#replyrow").height();k=window.pageYOffset||document.documentElement.scrollTop;l=document.documentElement.clientHeight||self.innerHeight||0;n=k+l;if(n-20<o){window.scroll(0,o-l+35)}else{if(m-20<k){window.scroll(0,m-35)}}i("#replycontent").focus().keyup(function(p){if(p.which==27){commentReply.revert()}})},600);return false},send:function(){var a={};i("#replysubmit .error").hide();i("#replysubmit .waiting").show();i("#replyrow input").not(":button").each(function(){var b=i(this);a[b.attr("name")]=b.val()});a.content=i("#replycontent").val();a.id=a.comment_post_ID;a.comments_listing=this.comments_listing;a.p=i('[name="p"]').val();if(i("#comment-"+i("#comment_ID").val()).hasClass("unapproved")){a.approve_parent=1}i.ajax({type:"POST",url:ajaxurl,data:a,success:function(b){commentReply.show(b)},error:function(b){commentReply.error(b)}});return false},show:function(m){var d=this,c,a,b,e,n;if(typeof(m)=="string"){d.error({responseText:m});return false}c=wpAjax.parseAjaxResponse(m);if(c.errors){d.error({responseText:wpAjax.broken});return false}d.revert();c=c.responses[0];a=c.data;b="#comment-"+c.id;if("edit-comment"==d.act){i(b).remove()}if(c.supplemental.parent_approved){n=i("#comment-"+c.supplemental.parent_approved);h(-1);if(this.comments_listing=="moderated"){n.animate({backgroundColor:"#CCEEBB"},400,function(){n.fadeOut()});return}}i(a).hide();i("#replyrow").after(a);b=i(b);d.addEvents(b);e=b.hasClass("unapproved")?"#FFFFE0":b.closest(".widefat, .postbox").css("backgroundColor");b.animate({backgroundColor:"#CCEEBB"},300).animate({backgroundColor:e},300,function(){if(n&&n.length){n.animate({backgroundColor:"#CCEEBB"},300).animate({backgroundColor:e},300).removeClass("unapproved").addClass("approved").find("div.comment_status").html("1")}})},error:function(b){var a=b.statusText;i("#replysubmit .waiting").hide();if(b.responseText){a=b.responseText.replace(/<.[^<>]*?>/g,"")}if(a){i("#replysubmit .error").html(a).show()}},addcomment:function(b){var a=this;i("#add-new-comment").fadeOut(200,function(){a.open(0,b,"add");i("table.comments-box").css("display","");i("#no-comments").remove()})}};i(document).ready(function(){var a,d,c,b;setCommentsList();commentReply.init();i(document).delegate("span.delete a.delete","click",function(){return false});if(typeof i.table_hotkeys!="undefined"){a=function(e){return function(){var l,n;l="next"==e?"first":"last";n=i(".tablenav-pages ."+e+"-page:not(.disabled)");if(n.length){window.location=n[0].href.replace(/\&hotkeys_highlight_(first|last)=1/g,"")+"&hotkeys_highlight_"+l+"=1"}}};d=function(e,l){window.location=i("span.edit a",l).attr("href")};c=function(){toggleWithKeyboard=true;i("input:checkbox","#cb").click().prop("checked",false);toggleWithKeyboard=false};b=function(e){return function(){var l=i('select[name="action"]');i('option[value="'+e+'"]',l).prop("selected",true);i("#doaction").click()}};i.table_hotkeys(i("table.widefat"),["a","u","s","d","r","q","z",["e",d],["shift+x",c],["shift+a",b("approve")],["shift+s",b("spam")],["shift+d",b("delete")],["shift+t",b("trash")],["shift+z",b("untrash")],["shift+u",b("unapprove")]],{highlight_first:adminCommentsL10n.hotkeys_highlight_first,highlight_last:adminCommentsL10n.hotkeys_highlight_last,prev_page_link_cb:a("prev"),next_page_link_cb:a("next")})}})})(jQuery);